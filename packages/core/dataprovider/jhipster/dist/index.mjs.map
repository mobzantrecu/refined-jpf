{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import axios, { AxiosInstance } from 'axios';\nimport { stringify } from 'query-string';\nimport { match } from 'ts-pattern';\nimport {\n    DataProvider,\n    HttpError,\n    CrudOperators,\n    CrudFilters,\n    CrudSorting,\n    BaseKey,\n    CrudFilter,\n    GetManyResponse,\n    GetListResponse,\n    CustomResponse,\n    DeleteOneResponse,\n    UpdateResponse,\n    CreateResponse,\n    GetOneResponse,\n} from '@refinedev/core';\nimport {\n    MetaDataQuery,\n    Pagination,\n    BaseRecord,\n} from '@refinedev/core/dist/interfaces';\n\nconst axiosInstance = axios.create();\n\naxiosInstance.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    (error) => {\n        const customError: HttpError = {\n            ...error,\n            message: error.response?.data?.message,\n            statusCode: error.response?.status,\n        };\n\n        return Promise.reject(customError);\n    }\n);\n\n/**\n *\n *\n * @see {@link https://github.com/jhipster/jhipster-bom/tree/main/jhipster-framework/src/main/java/tech/jhipster/service/filter| JHipster's filters code}\n */\nenum JHipsterCrudOperators {\n    'EQUALS' = 'equals',\n    'NOT_EQUALS' = 'notEquals',\n    'SPECIFIED' = 'specified',\n    'IN' = 'in',\n    'NOT_IN' = 'notIn',\n    'CONTAINS' = 'contains',\n    'DOES_NOT_CONTAIN' = 'doesNotContain',\n    'GREATER_THAN' = 'greaterThan',\n    'LESS_THAN' = 'lessThan',\n    'GREATER_THAN_OR_EQUAL' = 'greaterThanOrEqual',\n    'LESS_THAN_OR_EQUAL' = 'lessThanOrEqual',\n}\n\nconst mapOperator = (operator: CrudOperators): string => {\n    const op = match(operator)\n        .with('eq', () => JHipsterCrudOperators.EQUALS)\n        .with('ne', () => JHipsterCrudOperators.NOT_EQUALS)\n        .with('null', () => JHipsterCrudOperators.SPECIFIED)\n        .with('nnull', () => JHipsterCrudOperators.SPECIFIED)\n        .with('in', () => JHipsterCrudOperators.IN)\n        .with('nin', () => JHipsterCrudOperators.NOT_IN)\n        .with('contains', () => JHipsterCrudOperators.CONTAINS)\n        .with('ncontains', () => JHipsterCrudOperators.DOES_NOT_CONTAIN)\n        .with('gt', () => JHipsterCrudOperators.GREATER_THAN)\n        .with('gte', () => JHipsterCrudOperators.GREATER_THAN_OR_EQUAL)\n        .with('lt', () => JHipsterCrudOperators.LESS_THAN)\n        .with('lte', () => JHipsterCrudOperators.LESS_THAN_OR_EQUAL)\n        .otherwise((notSupportedOperator: any) => {\n            throw Error(`Operator ${notSupportedOperator} is not supported`);\n        });\n\n    return `${op}`;\n};\n\nexport const generateSort = (sort?: CrudSorting) => {\n    if (sort && sort.length > 0) {\n        const _sort: string[] = [];\n        const _order: string[] = [];\n\n        sort.map((item) => {\n            _sort.push(item.field);\n            _order.push(item.order);\n        });\n\n        return {\n            _sort,\n            _order,\n        };\n    }\n\n    return;\n};\n\nexport const generateFilter = (filters?: CrudFilters) => {\n    const queryFilters: { [key: string]: string } = {};\n\n    if (filters) {\n        filters.map((filter) => {\n            if ('field' in filter) {\n                const { field, operator, value } = filter;\n\n                const mappedOperator = mapOperator(operator);\n                queryFilters[`${field}.${mappedOperator}`] = value;\n            }\n        });\n    }\n\n    return queryFilters;\n};\n\n/**\n *\n * @privateRemarks\n * Methods are implemented as attributes of the class because {@link @pankod/refine-core#useDataProvider | the useDataProvider hook} needs to access them as an JSON Object.\n * The class it's marked as sealed because it may not be inherited and/or extended from. If you need to call another API or use a custom API call, then create another DataProvider or use the useCustom hook which will call the custom method in this class.\n *\n * @sealed\n **/\n\nclass JHipsterDataProvider implements DataProvider {\n    private apiUrl: Required<string>;\n    private httpClient: Required<AxiosInstance>;\n\n    constructor(apiUrl: string, httpClient: AxiosInstance = axiosInstance) {\n        this.apiUrl = apiUrl;\n        this.httpClient = httpClient;\n    }\n\n    public getApiUrl = (): string => {\n        return this.apiUrl;\n    };\n\n    public getOne = async <TData extends BaseRecord = BaseRecord>(params: {\n        resource: string;\n        id: BaseKey;\n        metaData?: MetaDataQuery;\n    }): Promise<GetOneResponse<TData>> => {\n        const { data } = await this.httpClient.get(\n            `${this.apiUrl}/${params.resource}/${params.id}`\n        );\n\n        return {\n            data,\n        };\n    };\n\n    /**\n     *\n     * TODO: check default values\n     **/\n    public getList = async <TData extends BaseRecord = BaseRecord>(\n        params: {\n            resource: string;\n            pagination?: Pagination;\n            hasPagination?: boolean;\n            sort?: CrudSorting;\n            filters?: CrudFilters;\n            metaData?: MetaDataQuery;\n            dataProviderName?: string;\n        } = {\n            hasPagination: true,\n            pagination: { current: 1, pageSize: 10 },\n            resource: '',\n        }\n    ): Promise<GetListResponse<TData>> => {\n        const url = `${this.apiUrl}/${params.resource}`;\n\n        const { current = 1, pageSize = 10 } = params.pagination ?? {};\n\n        const queryFilters = generateFilter(params.filters);\n\n        const query: {\n            _start?: number;\n            _end?: number;\n            _sort?: string;\n            _order?: string;\n        } = params.hasPagination\n            ? {\n                  _start: (current - 1) * pageSize,\n                  _end: current * pageSize,\n              }\n            : {};\n\n        const generatedSort = generateSort(params.sort);\n        if (generatedSort) {\n            const { _sort, _order } = generatedSort;\n            query._sort = _sort.join(',');\n            query._order = _order.join(',');\n        }\n\n        const { data, headers } = await this.httpClient.get(\n            `${url}?${stringify(query)}&${stringify(queryFilters)}`\n        );\n\n        const total = +(headers['x-total-count'] ?? Number.NaN);\n\n        return {\n            data,\n            total,\n        };\n    };\n\n    public getMany = async <TData extends BaseRecord = BaseRecord>(params: {\n        resource: string;\n        ids: BaseKey[];\n        metaData?: MetaDataQuery;\n        dataProviderName?: string;\n    }): Promise<GetManyResponse<TData>> => {\n        const idsInFilter: CrudFilter = {\n            field: 'id',\n            operator: 'in',\n            value: params.ids,\n        };\n        const queryFilters = generateFilter([idsInFilter]);\n\n        const { data } = await this.httpClient.get(\n            `${this.apiUrl}/${params.resource}?${stringify(queryFilters)}`\n        );\n\n        return {\n            data,\n        };\n    };\n\n    public create = async <\n        TData extends BaseRecord = BaseRecord,\n        TVariables = {}\n    >(params: {\n        resource: string;\n        variables: TVariables;\n        metaData?: MetaDataQuery;\n    }): Promise<CreateResponse<TData>> => {\n        const url = `${this.apiUrl}/${params.resource}`;\n\n        const { data } = await this.httpClient.post(url, params.variables);\n\n        return {\n            data,\n        };\n    };\n\n    public update = async <\n        TData extends BaseRecord = BaseRecord,\n        TVariables = {}\n    >(params: {\n        resource: string;\n        id: BaseKey;\n        variables: TVariables;\n        metaData?: MetaDataQuery;\n    }): Promise<UpdateResponse<TData>> => {\n        const url = `${this.apiUrl}/${params.resource}/${params.id}`;\n\n        const { data } = await this.httpClient.put(url, params.variables);\n\n        return {\n            data,\n        };\n    };\n\n    public deleteOne = async <\n        TVariables = {},\n        TData extends BaseRecord = BaseRecord\n    >(params: {\n        resource: string;\n        id: BaseKey;\n        variables?: TVariables;\n        metaData?: MetaDataQuery;\n    }): Promise<DeleteOneResponse<TData>> => {\n        const url = `${this.apiUrl}/${params.resource}/${params.id}`;\n\n        const { data } = await this.httpClient.delete(url, {\n            data: params.variables,\n        });\n\n        return {\n            data,\n        };\n    };\n\n    public custom = async <\n        TData extends BaseRecord = BaseRecord,\n        TQuery = unknown,\n        TPayload = unknown\n    >(params: {\n        url: string;\n        method:\n            | 'get'\n            | 'delete'\n            | 'head'\n            | 'options'\n            | 'post'\n            | 'put'\n            | 'patch';\n        sort?: CrudSorting;\n        filters?: CrudFilter[];\n        payload?: TPayload;\n        query?: TQuery;\n        headers?: {};\n        metaData?: MetaDataQuery;\n    }): Promise<CustomResponse<TData>> => {\n        throw Error('Not implemented');\n    };\n}\n\nconst JHipsterServer = (\n    apiUrl: string,\n    httpClient: AxiosInstance = axiosInstance\n): Omit<Required<DataProvider>, 'createMany' | 'updateMany' | 'deleteMany'> => {\n    const jhipsterDataProvider = new JHipsterDataProvider(apiUrl, httpClient);\n    return jhipsterDataProvider;\n};\n\nexport default JHipsterServer;\n"],"mappings":"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","names":[]}